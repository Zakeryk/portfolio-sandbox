<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANDBOX | R182 + BARBA</title>
    
    <style>
        :root { --bg: #050505; --card: rgba(20,20,20,0.6); --border: #333; --text: #eee; --dim: #666; --accent: #fff; }
        
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* THE CANVAS (PERSISTENT LAYER) */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1; /* Behind everything */
            pointer-events: none; /* Let clicks pass through */
        }

        /* LAYOUT */
        #app { max-width: 800px; margin: 0 auto; padding: 80px 20px; position: relative; z-index: 10; }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 40px; backdrop-filter: blur(5px); }
        .brand h1 { font-size: 12px; letter-spacing: 2px; margin: 0; color: var(--accent); }
        .controls button {
            background: transparent; border: 1px solid var(--dim); color: var(--dim);
            padding: 8px 12px; font-size: 9px; cursor: pointer; transition: 0.2s;
        }
        .controls button:hover { border-color: var(--accent); color: var(--accent); }

        /* GRID */
        .grid { display: grid; gap: 1px; background: var(--border); border: 1px solid var(--border); }
        
        .card { 
            background: var(--card); text-decoration: none; color: inherit; display: flex; 
            backdrop-filter: blur(10px); /* Glassmorphism */
            transition: background 0.2s;
        }
        .card:hover { background: rgba(50,50,50,0.8); }

        .card-visual { 
            background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            font-family: monospace; color: #444; border-right: 1px solid var(--border);
        }
        .card-info { flex: 1; padding: 0 20px; display: flex; flex-direction: column; justify-content: center; }
        .card-meta { display: flex; gap: 10px; font-size: 10px; color: var(--dim); font-family: monospace; }

        /* MODES */
        .grid.list-mode { grid-template-columns: 1fr; }
        .grid.list-mode .card { height: 64px; }
        .grid.list-mode .card-visual { width: 64px; height: 100%; }
        .grid.list-mode .card-info { flex-direction: row; justify-content: space-between; align-items: center; }

        .grid.tile-mode { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
        .grid.tile-mode .card { flex-direction: column; height: 240px; }
        .grid.tile-mode .card-visual { width: 100%; height: 160px; border-right: none; border-bottom: 1px solid var(--border); font-size: 24px; }
        .grid.tile-mode .card-info { padding: 15px; justify-content: space-between; }
    </style>

    <script src="https://unpkg.com/@barba/core"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="icon" type="image/png" href="./favicon.png?v=2">
</head>

<body data-barba="wrapper">

    <div id="canvas-container"></div>

    <main data-barba="container" data-barba-namespace="home">
        <div id="app">
            <header>
                <div class="brand"><h1>ZAK.SANDBOX</h1></div>
                <div class="controls"><button id="view-toggle">[ TILES ]</button></div>
            </header>

            <div class="grid list-mode" id="project-grid">
                </div>
        </div>
    </main>

    <script>
        const rawData = [
            { title: "Dark Mode Ecom", date: "2025-11-20", path: "#", tag: "DEV" },
            { title: "Three.js r182 Test", date: "2025-12-01", path: "#", tag: "3D" },
            { title: "Barba Transition", date: "2025-12-10", path: "#", tag: "UI" },
            { title: "Client Dashboard", date: "2025-10-15", path: "#", tag: "SaaS" }
        ];

        function initApp() {
            const grid = document.getElementById('project-grid');
            if(!grid) return;

            // 1. Render Grid
            grid.innerHTML = '';
            rawData.forEach(p => {
                const card = document.createElement('a');
                card.href = p.path;
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-visual">//</div>
                    <div class="card-info">
                        <div>${p.title}</div>
                        <div class="card-meta"><span>${p.tag}</span><span>${p.date}</span></div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // 2. Bind Toggle
            const btn = document.getElementById('view-toggle');
            if(btn) {
                btn.onclick = () => {
                    if (grid.classList.contains('list-mode')) {
                        grid.className = 'grid tile-mode';
                        btn.innerText = "[ LIST ]";
                    } else {
                        grid.className = 'grid list-mode';
                        btn.innerText = "[ TILES ]";
                    }
                };
            }
        }

        // Run on initial load
        initApp();
    </script>

    <script>
        barba.init({
            transitions: [{
                name: 'fade',
                leave(data) {
                    return gsap.to(data.current.container, { opacity: 0, y: -20, duration: 0.4 });
                },
                enter(data) {
                    return gsap.from(data.next.container, { 
                        opacity: 0, y: 20, duration: 0.4,
                        onStart: () => { initApp(); } // CRITICAL: Re-run UI logic
                    });
                }
            }]
        });
    </script>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.182.0/build/three.module.js" } }
    </script>
    <script type="module">
        import * as THREE from 'three';

        // Setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Fog to blend deep into background
        scene.fog = new THREE.FogExp2(0x050505, 0.08);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.z = 15;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // Object: Wireframe Icosahedron (Cyber/Node vibe)
        const geo = new THREE.IcosahedronGeometry(6, 2);
        const mat = new THREE.MeshBasicMaterial({ 
            color: 0x333333, 
            wireframe: true,
            transparent: true,
            opacity: 0.3
        });
        const mesh = new THREE.Mesh(geo, mat);
        scene.add(mesh);

        // Animation
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();
            
            mesh.rotation.y = t * 0.05;
            mesh.rotation.x = Math.sin(t * 0.1) * 0.1;
            
            renderer.render(scene, camera);
        }
        animate();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

</body>
</html>